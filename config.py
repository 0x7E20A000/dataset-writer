from openai import OpenAI
import os
from datetime import datetime
from converter import DataConverter
from dotenv import load_dotenv

# OpenAI API 설정
OPENAI_MODEL = "gpt-4o-mini"
MAX_TOKENS = 7000  # 최대 토큰 수 수정
TEMPERATURE = 0.75

# 생성 설정
TOPICS = [
    # 보안 기초 개념
    ("보안 3요소(CIA)와 기본 원칙", "security_basics"),
    ("사이버 킬체인의 이해", "cyber_killchain"),
    ("MITRE ATT&CK 프레임워크", "mitre_attack"),
    
    # 위협 분석
    ("위협 인텔리전스 개념과 활용", "threat_intelligence"),
    ("APT 그룹 분석과 대응", "apt_analysis"),
    ("악성코드 분석 기법과 도구", "malware_analysis"),
    
    # 취약점 관리
    ("취약점 분석 방법론", "vulnerability_assessment"),
    ("CVE와 취약점 스코어링", "cve_scoring"),
    ("제로데이 취약점 연구", "zeroday_research")
]

TOPIC_KEYWORDS = {
    "security_basics": [
        "기밀성, 무결성, 가용성의 개념",  # CIA 삼각형의 기본 개념
        "보안 정책과 절차",  # 기업 보안 정책 개요
        "위험 관리 기본 원칙",  # 위험의 식별과 평가
        "보안 통제의 종류 (예: 관리적, 물리적, 기술적)",  # 보안 통제의 기본 분류
        "보안 인식 교육의 중요성",  # 보안 인식을 높이기 위한 교육
        "권한 관리와 최소 권한 원칙 (Least Privilege)"  # 권한 관리의 핵심 원칙
    ],
    "cyber_killchain": [
        "정찰, 무기화, 전달 단계",  # 공격 사슬의 초기 단계
        "공격 실행과 설치 단계",  # 실제 공격 진행 단계
        "명령제어와 목적 달성 단계",  # 공격자가 목표를 달성하는 과정
        "각 단계별 대응 방안",  # 단계별 방어 전략
        "공격 전이 모델(Attack Pivoting)과 확산"  # 공격의 확산과 방향 전환 이해
    ],
    "mitre_attack": [
        "전술(Tactics)과 기법(Techniques) 이해",  # MITRE ATT&CK 프레임워크의 기초
        "공격자 그룹과 도구 (APT 그룹 등)",  # MITRE에서 정의된 공격자 그룹
        "완화 방안과 대응 전략",  # 주요 완화 방안
        "위협 모델링 활용과 연계",  # MITRE와 위협 모델링 활용
        "ATT&CK Navigator 활용"  # 프레임워크 매핑 시각화 도구
    ],
    "threat_intelligence": [
        "위협 정보 수집 방법 (OSINT 등)",  # 오픈 소스 정보 수집 개념
        "위협 인텔리전스 피드의 이해와 활용",  # TI 피드 구독과 실무 활용
        "APT 공격 그룹과 주요 특징 분석",  # 주요 공격 그룹 분석
        "지속적 위협 모니터링 및 추적",  # 위협 상황 모니터링
        "위협 인텔리전스 자동화 및 통합 도구"  # 인텔리전스 자동화 활용법
    ],
    "apt_analysis": [
        "APT 공격 그룹과 주요 특징",  # APT 공격의 대표적 특징
        "정찰과 초기 접근 기법",  # 초기 공격 단계에 주목
        "명령 제어 통신(C2) 분석 기법",  # C2 분석과 탐지
        "지속성 유지 전략 및 대응 방안"  # APT가 장기간 공격을 유지하는 방법
    ],
    "malware_analysis": [
        "악성코드 감염 경로 (예: 피싱, 취약점 공격)",  # 악성코드 유입 경로
        "정적 분석과 동적 분석 기법의 차이",  # 코드 분석과 실행 분석
        "Sandbox 환경에서의 안전한 분석",  # 실습에서 활용 가능한 분석 기법
        "백도어 및 루트킷 탐지",  # 은닉 기법과 탐지
        "랜섬웨어(Ransomware) 공격과 대응 방법"  # 실무적 대응 방안
    ],
    "vulnerability_assessment": [
        "취약점 평가와 위험 등급화 방법",  # 위험 평가 기준
        "취약점 스캐닝 도구 활용법 (Nessus, OpenVAS 등)",  # 도구의 설치 및 활용
        "취약점 관리 라이프사이클 이해",  # 취약점 발견-조치-평가의 흐름
        "취약점 조치 우선순위 설정 및 보고"  # 중요도에 따른 조치 우선순위
    ],
    "cve_scoring": [
        "CVE(Common Vulnerabilities and Exposures)란?",  # CVE의 기본 개념
        "CVSS 점수 산정 방법 이해",  # CVSS 메트릭과 가중치
        "공격 벡터와 영향 분석의 중요성",  # 벡터와 영향도를 통한 분석
        "취약점 심각도 평가와 결정 요인"  # 심각도를 결정하는 주요 요소
    ],
    "zeroday_research": [
        "제로데이 취약점의 정의와 개념",  # 제로데이 개념
        "제로데이 익스플로잇 개발 기법",  # 익스플로잇의 개발 과정
        "취약점 발견과 안전한 보고 절차",  # 취약점 발견 시 보고 방법
        "제로데이 대응 방안과 사례"  # 실무적 대응과 사례 연구
    ],
    "penetration_testing": [
        "Reconnaissance와 정보 수집 단계",  # 정보 수집 기법
        "취약점 스캐닝과 분석 방법",  # 스캐닝 도구 활용
        "Exploit과 Post-Exploitation 이해",  # 공격 수행 후 단계
        "보고서 작성과 권고 사항 정리",  # 실무에서의 보고서 구성
        "사회공학 기법(Social Engineering Techniques)"  # 인간을 노린 공격 기법
    ],
    "exploit_escalation": [
        "익스플로잇 작성과 테스트 방법",  # 익스플로잇의 구성과 테스트
        "권한 상승 기법과 원리 이해",  # 권한 상승의 중요 개념
        "Local 및 Remote Exploits의 차이",  # 로컬과 원격 공격의 차이점
        "포스트 익스플로잇 단계에서의 활동"  # 공격 후 활동과 방어 방법
    ],
    "social_engineering": [
        "사회공학의 정의와 주요 유형",  # 사회공학 공격 개요
        "피싱 공격 기법과 방어 전략",  # 피싱의 유형과 탐지 방법
        "물리적 접근과 Tailgating 기법",  # 물리적 접근을 통한 공격
        "사회공학 대응 교육과 실무 훈련"  # 대응 교육과 훈련 중요성
    ],
    "incident_response": [
        "보안 사고 대응 프로세스 개요",  # 사고 대응의 기본 흐름
        "침해사고 분석 절차와 기법",  # 사고 발생 시 분석 절차
        "포렌식 데이터 수집과 분석 방법",  # 디지털 증거 수집 방법
        "사후 보고서 작성과 교훈 도출 방법",  # 보고서 작성 및 피드백
        "위협 헌팅(Threat Hunting) 기법"  # 잠재적 위협 탐색 및 대응
    ],
    "digital_forensics": [
        "포렌식 수사 절차 개요",  # 포렌식 수사 단계
        "증거 수집 및 보존의 중요성",  # 증거의 중요성과 보존 기법
        "로그 분석과 메타데이터 활용",  # 로그 분석을 통한 사건 조사
        "디지털 장치 분석 기법",  # 디지털 기기의 포렌식 조사
        "메모리 포렌식(Memory Forensics)"  # 메모리 분석의 중요성
    ],
    "cloud_security": [
        "IaaS, PaaS, SaaS와 보안 책임 구분",  # 클라우드 서비스별 보안 책임
        "클라우드 보안 정책과 구성 관리",  # 클라우드 정책과 설정
        "IAM(Identity and Access Management)",  # 클라우드 접근 관리
        "데이터 암호화와 백업 전략",  # 데이터 보호 전략
        "서버리스 보안(Serverless Security) 기법"  # 서버리스 아키텍처 보안
    ]
}

# 기본 설정
DEFAULT_CONFIG = {
    "domain": "Information Security",
    "style": "focused, applied, and in-depth",  # 집중적이고 응용 중심, 깊이 있는 설명 스타일
    "language": "Korean",
    "num_sets": 10,  # 주제당 10세트의 대화 생성
}

# 시스템 프롬프트 설정 추가
SYSTEM_PROMPTS = {
    "security_expert": """정보보안 실무 학습에 최적화된 설명을 제공하십시오. 다음 지침을 따르세요:

    1. **핵심 원리와 실무 연결**: 각 개념의 핵심 원리를 설명한 후, 이를 실무 상황과 어떻게 연결할 수 있는지 구체적인 예시를 제공하세요.
    2. **단계적 사고 유도**: 학습자가 각 단계별로 이해할 수 있도록 논리적 순서에 따라 설명하되, 불필요한 반복은 피하고 중요한 포인트에 집중하세요.
    3. **실무 적용과 핵심 원칙 요약**: 설명 후 학습자가 기억해야 할 중요한 원칙을 요약하여 실무에서 바로 응용할 수 있도록 강조하세요.
    4. **생각을 유도하는 질문 제공**: 학습자가 스스로 문제를 해결해 볼 수 있도록, 응용력을 높이는 간단한 질문을 추가하세요.
    5. **최신 동향 및 실무 변화**: 최신 보안 동향과 기술 발전에 대해 간략히 언급하여, 학습자가 실무에 맞춰 발전할 수 있도록 하세요.

    각 답변에서 다음 요소들을 포함하도록 합니다:
    - 핵심 원리와 실무 적용 예시: 개념의 핵심 원리와 실무에서 이를 어떻게 적용할 수 있는지 설명
    - 단계적 사고 유도: 논리적 순서에 따라 개념을 설명하되, 중요한 단계에 집중
    - 기억할 핵심 원칙 요약: 학습자가 꼭 기억해야 할 원칙을 간단히 요약
    - 사고를 유도하는 질문: 학습자가 스스로 생각해 볼 수 있는 질문을 추가
    - 최신 동향과 실무 트렌드: 변화하는 보안 환경에 맞춘 최신 정보와 발전 가능성을 언급""",
}

# 출력 설정
OUTPUT_DIR = "training_data"